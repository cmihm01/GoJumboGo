<!DOCTYPE HTML> 
<html>
<head>
	<title>GoJumboGo!</title>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script type= "text/javascript" src = "firstmockup.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel ="stylesheet" href ="/stylesheets/style.css"> 

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Luckiest+Guy" rel="stylesheet">
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <meta name="google-signin-scope" content="profile email">
  <meta name="google-signin-client_id" content="512652555860-8fg7je25ha3t7t7f2v8stvvahl4n618r.apps.googleusercontent.com">


</head>

<body onload='show_user_info()'>
  <script>
      function show_user_info() {
        var username = "not logged in :("
        var message = "Please log in to access the user hub!"

        var user_indicator = document.getElementById("username");
        var user_indicator1 = document.getElementById("user1");
        user_indicator1.style.visibility = "hidden";
        var user_message = document.getElementById("loggged-indicator");
        document.getElementById("hub-lead").style.visibility = "hidden";
        document.getElementById("login-table").style.visibility = "hidden";

        if(sessionStorage.getItem('user') != null){
            username = sessionStorage.getItem('user');
            message = "Welcome to the User Hub, "
            user_indicator1.style.visibility = "visible";
            document.getElementById("hub-lead").style.visibility = "visible";
            document.getElementById("login-table").style.visibility = "visible";
            login_data(username);
        }

        user_indicator.innerHTML = username;
        user_message.innerHTML = message;
        user_indicator1.innerHTML = username + "!";

      }
      function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          console.log("logggging out");
          var user_indicator = document.getElementById("username");
          user_indicator.innerHTML = "not logged in :(";
          location.reload();
        });

      }

      function login_data(username) {
        var request = new XMLHttpRequest();
        request.open('GET', "https://immense-spire-32496.herokuapp.com/logins.json?username=" + encodeURI(username),
                                                                         true);

        request.send();

        request.onreadystatechange = function() {
            if (request.readyState == XMLHttpRequest.DONE) {
                if (request.status != 200)
                    alert ("Error loading user data. Please refresh page.");
                else {
                    var logins = JSON.parse(request.responseText);
                    draw_table(logins);
                }
            }
        }
      }
      function draw_table (logindata) {
        var table = document.getElementById("login-table");
        tabBody=document.getElementsByTagName("tbody").item(0);
        var num_logins = logindata.length;
        for (var i = 0; i < num_logins; i++) {
            console.log(logindata[i]);
            row=document.createElement("tr");
             cell1 = document.createElement("td");
             cell2 = document.createElement("td");
             textnode1=document.createTextNode(logindata[i].username);
             textnode2=document.createTextNode(logindata[i].time);
             cell1.appendChild(textnode1);
             cell2.appendChild(textnode2);
             row.appendChild(cell1);
             row.appendChild(cell2);
             tabBody.appendChild(row);
        }
        var loginmsg = document.getElementById("login-count");
        var newmsg;
        if (num_logins > 10)
          newmsg = num_logins + " times! We're glad you like GoJumboGo";
        else 
          newmsg = "only " + num_logins + "times. Thanks for joining us";
        loginmsg.innerHTML = newmsg;
      }
    </script>
  <nav class="navbar navbar-fixed-top navbar-inverse">
	  <a href="#" class="navbar-left"> <img class="logo" src="img/jumbo.png"> </a>
      <a class="navbar-brand" href="index.html">GoJumboGo!</a>
      <ul class="nav navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="index.html"> Play! <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="aboutus.html">About GoJumboGo!</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="loginpage.html">Login or Signup</a>
        </li>
      </ul>
      <div class="dropdown navbar-right">
      <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        <span class="glyphicon glyphicon-cog"></span>

        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
        <li><p id="logged-in-as">Hey! Looks like you are </p><p id="username"></p></li>
        <li role="separator" class="divider"></li>
        <li><a id="logout-button" href="#">User Hub</a></li>
      </ul>

    </nav>
    
   <div id = "jumbo-center">
	 <div class="jumbotron">
        <h1 class="display-3">User Hub</h1>
        <div class = "about-info">
        <h3 id = "loggged-indicator"> </h3><h3 id = "user1"> </h3>
        <p id = "hub-lead" class="lead"> Looks like you've logged in <p id="login-count"></p>!</p>
        <table class= "table" id = "login-table">
          <thead class="thead-inverse">
            <tr>
             <th>User</th>
             <th>Last Logged In</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      </div>
  </div>
</div>
</body>
</html>