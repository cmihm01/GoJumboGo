<!DOCTYPE HTML> 
<html>
<head>
	<title> GoJumboGo!</title>
	<!--<script type= "text/javascript" src = "login.js"></script>-->
  <meta name="google-signin-scope" content="profile email">
  <meta name="google-signin-client_id" content="512652555860-8fg7je25ha3t7t7f2v8stvvahl4n618r.apps.googleusercontent.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel ="stylesheet" href ="/stylesheets/style.css"> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Luckiest+Guy" rel="stylesheet">
</head>

<body onload="show_user_info()">
  <div class="alert alert-success" id="success-alert">
    <button type="button" class="close" data-dismiss="alert">x</button>
    <strong> See you later! </strong>
    You have been successfully logged out.
</div>
  <nav class="navbar navbar-fixed-top navbar-inverse">
    <a href="index.html" class="navbar-left"> <img class="logo" src="img/jumbo.png"> </a>
      <a class="navbar-brand" href="index.html">GoJumboGo!</a>
      <ul class="nav navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="index.html">Play! <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="aboutus.html"> About GoJumboGo! </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#"> Login or Signup </a>
        </li>
      </ul>
       <div class="dropdown navbar-right">
      <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        <span class="glyphicon glyphicon-cog"></span>

        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
        <li><p id="logged-in-as">Signed In As: </p><p id="username"></p></li>
        <li role="separator" class="divider"></li>
        <li><a id="logout-button" href="userinfo.html">User Hub</a></li>
        <li><a id="logout-button" href="#" onclick="signOut();" >Logout</a></li>
      </ul>
    </div>
    </nav>

  <!-- Boilerplate header with game title and navigation buttons -->
	<div id = "header"> 

<div id = "jumbo-center">
   <div class="jumbotron">
      <h1 class="display-3">Login or Sign Up!</h1>
      <div class="panel panel-default">
        <div class="panel-body">
           <p class = "info-blurb"> With GoJumboGo learning the basics of computer programming is a breeze!
               Keep track of your progress and get updates by creating an account with
               us using your Google account! </p>
           <div class="row">
            <div class="col-md-5">
              <div id="my-signin2"></div>
                  <script>
                    function onSuccess(googleUser) {
                      var username = googleUser.getBasicProfile().getName();
                      console.log('Logged in as: ' + username);
                      var user_indicator = document.getElementById("username");
                      user_indicator.innerHTML = username;
                      sessionStorage.setItem('user',username);
                      sendData(username);
                    }
                    function onFailure(error) {
                      console.log(error);
                    }
                    function renderButton() {
                      gapi.signin2.render('my-signin2', {
                        'scope': 'profile email',
                        'width': 240,
                        'height': 50,
                        'longtitle': true,
                        'theme': 'dark',
                        'onsuccess': onSuccess,
                        'onfailure': onFailure
                      });
                    }
                    function signOut() {
                      var auth2 = gapi.auth2.getAuthInstance();
                      auth2.signOut().then(function () {
                        var user_indicator = document.getElementById("username");
                        user_indicator.innerHTML = "not logged in :(";
                      });
                      $("#success-alert").show();
                      window.setTimeout(function() {
                          $("success-alert").fadeTo(2000, 500).slideUp(5000, function(){
                              $(this).remove(); 
                          });
                      }, 5000);
                      sessionStorage.clear();
                      //location.reload();
                    }
                     function show_user_info() {
                        $("#success-alert").hide();
                        var username = "not logged in :("
                        if(sessionStorage.getItem('myUserEntity') != null){
                            username = sessionStorage.getItem('user');
                        }
                        var user_indicator = document.getElementById("username");
                        user_indicator.innerHTML = username;
                      }
                      function sendData(username){

                          //used to collect the data
                          var theData;

                        //creating new XMLHttp Post Request
                          request = new XMLHttpRequest();
                          request.open("POST", 'https://immense-spire-32496.herokuapp.com/submit.json', true);
                          
                          //sets content type -- encoded url
                          request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                          request.onreadystatechange = function(){
                           if(request.readyState == 4 && request.status != 200) {
                                  console.log("Can't find the server!");
                            }
                            //still waiting for status 
                            else {
                                  console.log("In progress...");
                            }
                          };
                          theData ='username='+username;
                          request.send(theData);
                      }
                  </script>

                  <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
              </div>
            </div>
      </div>
      </div>
      </div>
      </div>
      </div>

</body>
</html>